import os
os.environ["HF_TOKEN"] = "REMOVED"
os.environ["PYTORCH_SDP_DISABLE_FLASH_ATTN"] = "1"
os.environ["PYTORCH_ENABLE_SDPA"] = "0"

from transformers import AutoProcessor, Gemma3ForConditionalGeneration

import torch
torch.backends.cuda.enable_flash_sdp(False)
torch.backends.cuda.enable_math_sdp(True)
torch.backends.cuda.enable_mem_efficient_sdp(False)
import pandas as pd
import re
import gc



class Commentator:
    def __init__(self):
        """
        Initialize the Gemma4 model for text generation.
        """
        #print("Loading processor...")
        self.processor = AutoProcessor.from_pretrained("google/gemma-3-4b-it")

        print("Loading model (16-bit mode activated)...")
        self.model = Gemma3ForConditionalGeneration.from_pretrained(
            "google/gemma-3-4b-it",
            torch_dtype=torch.bfloat16
            #device_map="auto"
        ).eval().to("cuda")

    def rewrite_text(self, prompt, max_length=500):
        """
        Reformulates a detailed VLM description into a concise and professional sports commentary.
        """
        print("Generating commentary...")

        messages = [
            {
                "role": "system",
                "content": [{"type": "text", "text": "You are a helpful sports commentator."}]
            },
            {
                "role": "user",
                "content": [
                    {"type": "text", "text": prompt}
                ]
            }
        ]

        inputs = self.processor.apply_chat_template(
                messages,
                add_generation_prompt=True,
                tokenize=True,
                return_dict=True,
                return_tensors="pt"
            ).to(self.model.device)
        
        inputs = {
                k: (
                    v.to(self.model.device, dtype=torch.bfloat16) if v.dtype.is_floating_point
                    else v.to(self.model.device)
                )
                for k, v in inputs.items()
            }
        
        input_len = inputs["input_ids"].shape[-1]

        with torch.inference_mode():
            generation = self.model.generate(**inputs, max_new_tokens=max_length, do_sample=True)
            generation = generation[0][input_len:]
        
        decoded = self.processor.decode(generation, skip_special_tokens=True)
        print(f"Commentary: {decoded}\n")

        return decoded


def generate_commentary(descriptions, match_context):
    """
    Converts detailed VLM-generated action descriptions into natural sports commentary.

    Args:
    - descriptions (dict): Dictionary mapping game timestamps to {label, description}.
    - match_context (str): General match context (score, teams, situation).
    - num_variations (int): Number of different commentary versions per action.
    - save_path (str, optional): If provided, saves the outputs to a CSV file.

    Returns:
    - pd.DataFrame containing the generated commentaries.
    """
    results = {}
    for path, data in descriptions.items():
        with torch.no_grad():
            commentator = Commentator()
            action_label = data["label"]
            action_description = data["description"]

            print(f"\nðŸŽ™ Generating commentary for {action_label}...")

            # Construct the LLM prompt
            # llm_prompt = f"""
            #                 You are a professional live sports commentator. 
            #                 Your job is to generate a natural, emotionally engaging **live soccer commentary** based on the given raw action description. Your commentary will be **converted into an audio track using a text-to-speech model**.

            #                 **Important Guidelines**:
            #                 - **IMAGINE YOU ARE LIVE ON AIR** describing this moment in real time.
            #                 - **Follow the EXACT CHRONOLOGY of the action with the TIMESTAMPS**, as if you were watching and reacting to it live.
            #                 - Your output must be **AS NATURAL, EMOTIONAL and HUMAN as POSSIBLE**, with the **RIGHT LEVEL OF EXCITEMENT**: 
            #                     - **BIG EVENTS (GOALS, PENALTIES, SHOTS ON TARGET, LAST-MINUTE ACTIONS)** should be **HIGHLY ENERGETIC** with shouting and excitement.
            #                     - **LOW-STAKES EVENTS (THROW-INS, FOULS, SUBSTITUTIONS)** should be **MORE DESCRIPTIVE AND NEUTRAL, WITH FEWER EXCLAMATION MARKS**.
            #                 - When there is a GOAL, a PENALTY or a SHOT, you can SHOUT but make it clear in the commentary so the text-to-speech model can transcribe it
            #                 - **Your commentary must fit exactly within 10 seconds**, so BE CONCISE YET DESCRIPTIVE.
            #                 - Use **SHORT AND ENERGETIC SENTENCES**, avoid unnecessary introductions.
            #                 - **Use TEXT FORMATTING to create expressive speech**:
            #                     - **SHOUT important words**: `"GOOOOAAALLL!!!"`, `"WHAT A STRIKE!"`, `"UNBELIEVABLE SAVE!!!"`
            #                     - **Elongate dramatic words**: `"GOOOOAAAAAAL!"`, `"NOOOOO! HE MISSED!!!"`
            #                     - **Use suspenseful pauses**: `"Messi... takes a step... SHOOTSâ€”GOOOOOAAAALLL!!!"`
            #                     - **Use sound-like words** for realism: `"OH WOW! WHAT A STRIKE! THE CROWD ERUPTS!!!"`
            #                 - **Generate only one version** of the commentaryâ€”do not provide multiple variations or repeat the same event. **DON'T REPEAT THE TIMESTAMPS** you see in the description. **DO NOT include extra labels like 'Commentary:' or explanations about what you are doing.**
            #                 - USE THE MATCH_CONTEXT and the JERSEY-to-TEAM association to name the players (e.g. the Tottenham player). If a DESCRIBED COLOR DOESN'T MATCH with the MATCH_CONTEXT, don't use it. 
            #                 - Make sure you COVER THE WHOLE DESCRIPTION. You need to cover the full action, you can use the given timestamps to comment until the end of the action. IF SOME DESCRIPTION PARTS SEEM USELESS, DON'T USE THEM.

            #                 **Example Style (for a penalty goal)**:
            #                 - `"The Tottenham player steps up... he shootsâ€”GOOOOOAAAAAALLLLL!!! The keeper dives the wrong way! WHAT A FINISH!!!"`
            #                 - `"Oh, what a pass! The striker controls itâ€”LEFT FOOT SHOTâ€”AND ITâ€™S INNNNN!!!"`
            #                 - `"The ball is crossed in... header! It bouncesâ€”THE GOALKEEPER CAN'T REACH IT!!! INCREDIBLE!!!"`


            #                 Here is some context about the match you are commenting. USE THE JERSEY COLORS TO NAME THE TEAMS.
            #                 MATCH_CONTEXT: {match_context}

            #                 **Now, generate exactly ONE 10-second commentary (MAXIMUM 6 to 8 SENTENCES) for the following action description:**
            #                 '{action_description}'
            #                 """
            
            # llm_prompt = f"""
            # You are a professional live soccer commentator. 
            # Your task is to generate a vivid and emotionally engaging **10-second spoken commentary** based on a detailed frame-by-frame action description. 

            # Imagine you're broadcasting live: your words will be **converted into audio** using text-to-speech, so speak naturally, with excitement and clarity.

            # ---

            # **Guidelines**:
            # - Follow the **CHRONOLOGY OF ACTIONS CLOSELY**, reflecting the sequence described (use the **timestamps as implicit structure**, but **donâ€™t include them** in your output). DON'T REVEAL the OUTCOME of the action BEFORE IT HAPPENS.
            # - Make sure you COVER THE DESCRIPTION CHRONOLOGICALLY. You can USE THE GIVEN TIMESTAMPS to comment until the end of the action. USE ONLY THE DESCRIPTIONS BETWEEN 0 AND 10 SECONDS.
            # - Your commentary must be **live, energetic, and natural**. 
            # - FIT EVERYTHING WITHIN 10 SECONDS â€” aim for **5 to 6 VERY SHORT AND CONCISE SENTENCES**.
            # - **Your commentary must fit exactly within 10 seconds**, so USE CONCISE YET NATURAL SENTENCES.
            # - DON'T PUT ANY STAR *
            # - JUST GIVE THE OUTPUT, avoid unnecessary introduction. **DO NOT include extra labels like 'Commentary:' or explanations about what you are doing.**

            # - Jersey color is linked to team identity. USE TEAM NAMES INSTEAD OF JERSEY COLOR from this MATCH CONTEXT:
            # {match_context}

            # **Tone**:
            # - ONLY SAY GOOAALL IF THERE IS ACTUALLY A GOAL
            # -**Use TEXT FORMATTING to create expressive speech** for SUSPENSEFUL ACTIONS:
            #     - **SHOUT important words**: `"GOOAALL!!!"`, `"WHAT A STRIKE!"`, `"UNBELIEVABLE SAVE!!!"`
            #     - **Elongate dramatic words**: `"GOOAAAL!"`, `"NOOOO! HE MISSED!!!"`
            #     - **Use suspenseful pauses**: `"Messi... takes a step... SHOOTSâ€”GOOAAALLL!!!"`
            #     - **Use sound-like words** for realism: `"OH WOW! WHAT A STRIKE! THE CROWD ERUPTS!!!"`
            # - However don't try to name the players, DON'T put things like [Player Name]


            # ---

            # **IMPORTANT**:
            # - Cover the full action step-by-step.
            # - **Donâ€™t summarize**. Capture the evolving intensity.
            # - **Only output the final commentary**, no metadata, no labels.

            # ---

            # Here is the action description to turn into a 10-second commentary (MAXIMUM 5 TO 6 SENTENCES - MAXIMUM 200 characters):
            # '{action_description}'
            # """

            llm_prompt = f"""
            You are a professional live soccer commentator. 
            Your task is to generate a vivid and emotionally engaging **10-second spoken commentary** based on a detailed frame-by-frame action description. 

            **Guidelines**:
            - Follow the **CHRONOLOGY OF ACTIONS CLOSELY**, reflecting the sequence described (use the **timestamps as implicit structure**, but - Your commentary must be **live, energetic, and natural**. 

            - Jersey color is linked to team identity. USE TEAM NAMES INSTEAD OF JERSEY COLOR from this MATCH CONTEXT:
            {match_context}

            HERE, action_label = {action_label}

            Here is the action description to turn into a 30 words commentary MAXIMUM:):
            '{action_description}'
            """
            

            commentary = commentator.rewrite_text(llm_prompt)
            print(f"len de commentary = {len(commentary.split(' '))}")
            # results[path] ={
            #         "Action": action_label,
            #     "Raw Description": action_description,
            #     "Generated Commentary": commentary
            # }
        del commentator, commentary, llm_prompt
        torch.cuda.empty_cache()
        gc.collect()

    return results

DESCRIPTIONS_OUTPUT = {'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_0_Corner.mp4': {'timestamp': '1 - 00:37', 'label': 'Corner', 'description': '**Time: 0sâ€“1s**\n- The ball is in play near the corner flag. A player in a white jersey is controlling the ball, preparing to take a corner kick. Other players are positioned around the penalty area, ready to react.\n\n**1sâ€“2s**\n- The player in the white jersey takes the corner kick, sending the ball into the penalty area. Opposing players in blue jerseys are positioned to defend against the cross.\n\n**2sâ€“3s**\n- The ball is in mid-air, heading towards the goal. Players in blue jerseys are jumping and attempting to head the ball away from their goal.\n\n**3sâ€“4s**\n- The ball is close to the goal line, with players in blue jerseys trying to clear it. The goalkeeper in a blue jersey is positioned near the goalpost, ready to make a save if necessary.\n\n**4sâ€“5s**\n- The ball is cleared by a player in a blue jersey, who kicks it back into play. The ball is now in the midfield area, with players from both teams moving to regain control.\n\n**5sâ€“6s**\n- The ball is passed by a player in a white jersey to a teammate near the center circle. The player in white is looking for an opportunity to advance the ball further.\n\n**6sâ€“7s**\n- The player in white passes the ball to another teammate, who is positioned closer to the goal. The player in white is still in the process of moving forward.\n\n**7sâ€“8s**\n- The player in white receives the pass and prepares to take a shot on goal. The goalkeeper in blue is positioned near the goalpost, ready to defend.\n\n**8sâ€“9s**\n- The player in white takes a shot on goal. The ball is heading towards the goal, with the goalkeeper in blue attempting to make a save.\n\n**9sâ€“10s**\n- The ball hits the crossbar and bounces back out of play. The goalkeeper in blue catches the ball, preventing it from entering the net. The players in white are disappointed, while the players in blue celebrate the successful clearance.'}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_4_Throw-in.mp4': {'timestamp': '1 - 01:34', 'label': 'Throw-in', 'description': "**Time: 0sâ€“1s**\n- A player wearing a blue jersey with the number 25 on the back is holding a soccer ball above his head. He appears to be preparing to throw the ball in.\n\n**1sâ€“2s**\n- The player lowers the ball slightly and begins to move forward, indicating he is about to execute the throw-in.\n\n**2sâ€“3s**\n- The player continues to walk while holding the ball, maintaining a steady pace towards the sideline where the throw-in will take place.\n\n**3sâ€“4s**\n- The player reaches the sideline and throws the ball into the air, initiating the throw-in.\n\n**4sâ€“5s**\n- The ball is thrown into the air, and players from both teams are positioned around the throw-in area, ready to react to the ball's trajectory.\n\n**5sâ€“6s**\n- The ball descends towards the field, and players from the team in white jerseys begin to move towards the ball, anticipating a potential clearance or interception.\n\n**6sâ€“7s**\n- The ball lands near the feet of a player in a white jersey, who appears to be preparing to control or pass the ball.\n\n**7sâ€“8s**\n- The player in white gains possession of the ball and starts to dribble it away from the throw-in spot, moving towards the midfield.\n\n**8sâ€“9s**\n- The player in white continues to dribble the ball, passing it to a teammate further up the field.\n\n**9sâ€“10s**\n- The player in white passes the ball to another teammate, who is now in a better position to advance the play. The ball is passed quickly, and the opposing team in blue jerseys begins to defend against the advancing play."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_6_Throw-in.mp4': {'timestamp': '1 - 01:52', 'label': 'Throw-in', 'description': "### Detailed Analysis of the Video Clip\n\n#### Time: 0sâ€“1s\n- **Player Action**: A player in a blue jersey (number 29) is preparing to take a throw-in. He is holding the ball with both hands above his head.\n- **Ball Movement**: The ball is stationary, held by the player.\n- **Team Roles**: The player is a defender, and he is preparing to throw the ball back into play.\n\n#### Time: 1sâ€“2s\n- **Player Action**: The player in the blue jersey (number 29) begins to throw the ball. His arm is extended, and the ball is in motion.\n- **Ball Movement**: The ball is thrown forward, starting its trajectory towards the field.\n- **Team Roles**: The player's teammates in blue jerseys are positioned near the sideline, ready to receive the throw-in.\n\n#### Time: 2sâ€“3s\n- **Player Action**: The player in the blue jersey (number 29) completes the throw-in. His arm is fully extended, and the ball is now traveling through the air.\n- **Ball Movement**: The ball is in mid-air, heading towards the field.\n- **Team Roles**: The player's teammates in blue jerseys remain in position, anticipating the throw-in.\n\n#### Time: 3sâ€“4s\n- **Player Action**: The ball continues its flight after being thrown by the player in the blue jersey (number 29).\n- **Ball Movement**: The ball is still in the air, moving towards the field.\n- **Team Roles**: The player's teammates in blue jerseys are still positioned near the sideline, ready to receive the throw-in.\n\n#### Time: 4sâ€“5s\n- **Player Action**: The ball reaches the field and lands near the center circle.\n- **Ball Movement**: The ball is now on the ground, and players from both teams are positioning themselves to gain possession.\n- **Team Roles**: The player in the blue jersey (number 29) has completed the throw-in, and the ball is now in play.\n\n#### Time: 5sâ€“6s\n- **Player Action**: The ball is in play, and players from both teams are competing for possession.\n- **Ball Movement**: The ball is rolling across the field.\n- **Team Roles**: Players in white jerseys (opposing team) are defending, while players in blue jerseys (home team) are advancing.\n\n#### Time: 6sâ€“7s\n- **Player Action**: A player in a white jersey (opposing team) gains control of the ball.\n- **Ball Movement**: The player in the white jersey dribbles the ball forward.\n- **Team Roles**: The player in the white jersey is advancing with the ball, while players in blue jerseys are tracking him.\n\n#### Time: 7sâ€“8s\n- **Player Action**: The player in the white jersey continues to dribble the ball forward.\n- **Ball Movement**: The ball is being controlled by the player in the white jersey.\n- **Team Roles**: The player in the white jersey is advancing with the ball, while players in blue jerseys are tracking him.\n\n#### Time: 8sâ€“9s\n- **Player Action**: The player in the white jersey passes the ball to a teammate.\n- **Ball Movement**: The ball is passed forward.\n- **Team Roles**: The player in the white jersey makes a pass, and the ball is now in the possession of another player in a white jersey.\n\n#### Time: 9sâ€“10s\n- **Player Action**: The player in the white jersey receives the ball and continues to advance.\n- **Ball Movement**: The ball is being controlled by the player in the white jersey.\n- **Team Roles**: The player in the white jersey is advancing with the ball, while players in blue jerseys are tracking him.\n\n### Summary\nThe sequence shows a player in a blue jersey taking a throw-in and throwing the ball back into play. The ball travels through the air and lands near the center circle, where players from both teams compete for possession. The player in the white jersey gains control of the ball and starts advancing with it, passing it to a teammate who continues to move forward."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_7_Goal.mp4': {'timestamp': '1 - 02:07', 'label': 'Goal', 'description': '**Time: 0sâ€“1s**\n- The ball is in play near the Tottenham Hotspur (TOTT) midfield area. A player in a white jersey (TOTT) is controlling the ball while being marked by a player in a blue jersey (CHE).\n\n**Time: 1sâ€“2s**\n- The player in the white jersey passes the ball to a teammate positioned further upfield. The player in the blue jersey continues to track the movement of the ball.\n\n**Time: 2sâ€“3s**\n- The white-jerseyed player receives the pass and dribbles forward, advancing towards the Chelsea (CHE) defense.\n\n**Time: 3sâ€“4s**\n- The player in the white jersey continues to advance with the ball, evading the pressure from the blue-jerseyed defender.\n\n**Time: 4sâ€“5s**\n- The white-jerseyed player makes a quick pass to another teammate who is positioned closer to the CHE goal.\n\n**Time: 5sâ€“6s**\n- The teammate in the white jersey receives the pass and takes a shot at the CHE goal. The ball is directed towards the CHE goalkeeper.\n\n**Time: 6sâ€“7s**\n- The CHE goalkeeper dives to make a save, but the ball goes past him into the net.\n\n**Time: 7sâ€“8s**\n- The ball is now inside the CHE goal, and the TOTT players celebrate the goal. They run towards each other, hugging and cheering.\n\n**Time: 8sâ€“9s**\n- The TOTT players continue to celebrate, with one player raising his arms in triumph.\n\n**Time: 9sâ€“10s**\n- The TOTT players gather around, embracing each other in joy. The crowd in the background is also seen cheering enthusiastically.'}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_8_Substitution.mp4': {'timestamp': '1 - 02:11', 'label': 'Substitution', 'description': "### Detailed Analysis of the Video Clip\n\n#### Time: 0sâ€“1s\n- **Description**: The scene opens with a wide view of the pitch, showing Tottenham Hotspur players in white jerseys advancing towards Chelsea's goal. The ball is being passed around by Tottenham players, with one player in possession near the center of the field. The Chelsea defense, in blue jerseys, is positioned to intercept or defend against the attack. The crowd is visible in the background, adding to the atmosphere of the match.\n\n#### Time: 1sâ€“2s\n- **Description**: The ball is now closer to the Chelsea penalty area. A Tottenham player in white is dribbling the ball while being closely marked by a Chelsea defender. The ball is moving quickly, and the player in white is trying to find a way through the defensive line.\n\n#### Time: 2sâ€“3s\n- **Description**: The ball is now inside the Chelsea penalty area. A Tottenham player in white has managed to bypass the Chelsea defenders and is taking a shot at the goal. The goalkeeper in blue is preparing to make a save.\n\n#### Time: 3sâ€“4s\n- **Description**: The ball is in mid-air, heading towards the goal. The Tottenham player who took the shot appears to have scored, as the ball goes past the goalkeeper. The crowd erupts in celebration.\n\n#### Time: 4sâ€“5s\n- **Description**: The scene shifts to show Tottenham players celebrating the goal. Two players in white jerseys are hugging and cheering, clearly excited about the score. The camera focuses on their faces, showing their joy and relief.\n\n#### Time: 5sâ€“6s\n- **Description**: The camera pans slightly to show another Tottenham player in white, also celebrating the goal. He is clapping his hands and looking towards the crowd, acknowledging their support.\n\n#### Time: 6sâ€“7s\n- **Description**: The scene continues to focus on the Tottenham players celebrating. One player is seen running towards the corner flag, still in high spirits. The crowd is visible in the background, cheering loudly.\n\n#### Time: 7sâ€“8s\n- **Description**: The camera captures a close-up of a Tottenham player in white, who is now walking away from the goal area. He appears to be catching his breath after the intense celebration.\n\n#### Time: 8sâ€“9s\n- **Description**: Another Tottenham player in white is shown, this time looking towards the crowd. He seems to be acknowledging the fans' cheers, possibly giving a thumbs-up gesture.\n\n#### Time: 9sâ€“10s\n- **Description**: The final frame shows a Tottenham player in white, who is now walking back towards the midfield. He appears to be composed and focused, likely preparing for the next phase of the game.\n\n### Summary\nThe video clip captures a crucial moment where Tottenham Hotspur scores a goal against Chelsea. The sequence starts with Tottenham players advancing towards the goal, followed by a successful shot that results in a goal. The celebration is evident as players hug and cheer, with the crowd responding enthusiastically. The final frames show the players regaining composure and preparing for the next part of the match."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_9_Throw-in.mp4': {'timestamp': '1 - 03:40', 'label': 'Throw-in', 'description': '**Time: 0sâ€“1s**\n- The ball is thrown in by a player in a white jersey, likely from the corner flag area. The throw-in is directed towards the center of the field where players from both teams are positioned.\n\n**Time: 1sâ€“2s**\n- The ball travels through the air, and players from both teams begin to move towards it. The player who threw the ball is now near the corner flag, preparing to receive the ball if it is returned.\n\n**Time: 2sâ€“3s**\n- The ball lands near the center of the field, and players start to gather around it. The player in the white jersey who threw the ball is now moving back towards his own half.\n\n**Time: 3sâ€“4s**\n- A player in a blue jersey gains possession of the ball after it lands. He starts to dribble forward, looking to pass or shoot.\n\n**Time: 4sâ€“5s**\n- The player in the blue jersey passes the ball to a teammate who is positioned further up the field. The pass is made with precision, and the receiving player is ready to continue the play.\n\n**Time: 5sâ€“6s**\n- The receiving player in the blue jersey controls the ball and begins to move forward, looking for an opportunity to pass or shoot. Other players from both teams are positioning themselves strategically.\n\n**Time: 6sâ€“7s**\n- The player in the blue jersey continues to advance with the ball, passing it to another teammate who is also moving forward. The ball is passed quickly, and the receiving player is ready to make another move.\n\n**Time: 7sâ€“8s**\n- The player in the blue jersey receives the ball again and continues to dribble forward, looking for an opening. Other players from both teams are closing in, trying to intercept the ball.\n\n**Time: 8sâ€“9s**\n- The player in the blue jersey makes a quick pass to a teammate who is positioned on the wing. The pass is precise, and the receiving player is ready to take advantage of the space created.\n\n**Time: 9sâ€“10s**\n- The player in the blue jersey who received the pass now has the ball and is looking to make a decision. He can either pass to another teammate or attempt a shot on goal. The goalkeeper and defenders from the opposing team are positioned to react accordingly.'}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_10_Foul.mp4': {'timestamp': '1 - 04:31', 'label': 'Foul', 'description': "**Time: 0sâ€“1s**\nA player in a blue jersey dribbles the ball forward while being closely marked by a player in a white jersey. The blue player is advancing towards the center of the field.\n\n**1sâ€“2s**\nThe blue player continues to dribble, maintaining possession despite the pressure from the white-marked player. The ball is moving towards the midfield area.\n\n**2sâ€“3s**\nThe blue player passes the ball to a teammate positioned further upfield. The pass is made with precision, aiming to create space for a potential attack.\n\n**3sâ€“4s**\nThe ball is received by the teammate in the white jersey who is now in possession. The white team starts to organize their play, with players moving into strategic positions.\n\n**4sâ€“5s**\nThe white team begins to distribute the ball among themselves, looking to build an attacking move. The blue team remains defensive, positioning themselves to intercept or challenge the white team's progress.\n\n**5sâ€“6s**\nThe white team continues to pass the ball around, trying to find an opening. The blue team's defense remains compact, attempting to disrupt the white team's build-up.\n\n**6sâ€“7s**\nThe white team advances the ball deeper into the blue team's half. The blue team's defense tightens, with players closing down spaces and preparing to regain control.\n\n**7sâ€“8s**\nThe white team makes another pass, this time to a player on the wing. The blue team's right-back steps forward to intercept the ball, but the white player manages to maintain possession.\n\n**8sâ€“9s**\nThe white player dribbles past the blue defender, advancing towards the penalty area. The blue team's goalkeeper and defenders position themselves to defend against any potential shot.\n\n**9sâ€“10s**\nThe white player takes a shot at goal, but the ball is saved by the blue goalkeeper. The blue team regains possession and starts to counter-press the white team."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_12_Throw-in.mp4': {'timestamp': '1 - 06:21', 'label': 'Throw-in', 'description': '**Time: 0sâ€“1s**\n- A player in a light blue jersey is seen walking on the field, likely preparing for the throw-in. The ball is not visible in these frames.\n\n**Time: 1sâ€“2s**\n- The camera shifts to show a wider view of the field, revealing players from both teams positioned near the corner flag. The ball is not yet in play.\n\n**Time: 2sâ€“3s**\n- The ball is thrown into the field by a player in a dark blue jersey. It travels through the air towards the corner area where the players are positioned.\n\n**Time: 3sâ€“4s**\n- The ball lands near the corner flag, and players begin to move into position to receive or contest the throw-in.\n\n**Time: 4sâ€“5s**\n- The ball is caught by a player in a dark blue jersey near the corner flag. This player appears to be preparing to throw the ball back into play.\n\n**Time: 5sâ€“6s**\n- The player in the dark blue jersey throws the ball back into the field, aiming it towards the center of the pitch.\n\n**Time: 6sâ€“7s**\n- The ball travels through the air, and players from both teams begin to move into position to contest possession.\n\n**Time: 7sâ€“8s**\n- The ball lands near the center of the pitch, and players start to engage in the ensuing play.\n\n**Time: 8sâ€“9s**\n- The ball is quickly contested by players from both teams, with one player in a dark blue jersey gaining control of the ball.\n\n**Time: 9sâ€“10s**\n- The player in the dark blue jersey dribbles the ball forward, attempting to create space and advance the ball up the field.'}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_13_Foul.mp4': {'timestamp': '1 - 06:33', 'label': 'Foul', 'description': "**Time: 0sâ€“1s**\n- A player in a white jersey dribbles the ball forward while being closely marked by a player in a blue jersey. The white-jerseyed player is advancing towards the center of the field.\n\n**1sâ€“2s**\n- The white-jerseyed player continues to dribble past the blue-jerseyed defender, maintaining possession of the ball. The ball is moving forward along the ground.\n\n**2sâ€“3s**\n- The white-jerseyed player accelerates slightly, attempting to create space between himself and the blue-jerseyed defender. The ball is still close to his feet.\n\n**3sâ€“4s**\n- The white-jerseyed player is now in a more open area of the field, with the blue-jerseyed defender still nearby. The ball is positioned near the player's right foot.\n\n**4sâ€“5s**\n- The white-jerseyed player takes a quick touch with the ball, preparing to make a pass or continue dribbling. The blue-jerseyed defender is still within close proximity.\n\n**5sâ€“6s**\n- The white-jerseyed player makes a slight turn, looking to either pass the ball or maintain control. The blue-jerseyed defender closes in, trying to intercept.\n\n**6sâ€“7s**\n- The white-jerseyed player passes the ball to a teammate who is positioned further upfield. The blue-jerseyed defender is still in pursuit.\n\n**7sâ€“8s**\n- The white-jerseyed player who received the pass is now in possession of the ball again, dribbling forward. The blue-jerseyed defender is still nearby, attempting to close down the space.\n\n**8sâ€“9s**\n- The white-jerseyed player continues to dribble, looking to advance the ball deeper into the opponent's half. The blue-jerseyed defender is still in close pursuit.\n\n**9sâ€“10s**\n- The white-jerseyed player is now in a more advanced position on the field, with the blue-jerseyed defender still nearby. The ball is close to the player's feet, indicating he is about to make another move."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_14_Foul.mp4': {'timestamp': '1 - 06:41', 'label': 'Foul', 'description': '**Time: 0sâ€“1s**\nA player in a blue jersey dribbles the ball forward while being closely marked by a player in a white jersey. The blue player is advancing towards the center of the field.\n\n**1sâ€“2s**\nThe blue player continues to dribble, maintaining control of the ball. The white-marking player is still in close pursuit, attempting to intercept or challenge.\n\n**2sâ€“3s**\nThe blue player accelerates slightly, trying to create space between himself and the defender. The white player adjusts his position, preparing to tackle.\n\n**3sâ€“4s**\nThe blue player passes the ball to a teammate positioned further upfield. The white player is still in close proximity, ready to react to the pass.\n\n**4sâ€“5s**\nThe ball is now with the teammate who received it. He is facing away from the camera, looking to make a move or pass.\n\n**5sâ€“6s**\nThe teammate in blue starts to dribble the ball again, looking to advance it further up the field. The white player is still marking him closely.\n\n**6sâ€“7s**\nThe blue player continues to dribble, trying to find an opening. The white player is still in close pursuit, attempting to defend against the attack.\n\n**7sâ€“8s**\nThe blue player passes the ball to another teammate who is positioned near the center of the field. The white player is still marking him, trying to prevent any progress.\n\n**8sâ€“9s**\nThe new teammate in blue receives the ball and begins to dribble. The white player is still in close proximity, attempting to defend.\n\n**9sâ€“10s**\nThe blue player continues to dribble, looking for an opportunity to pass or shoot. The white player is still marking him closely, trying to prevent any progress.\n\n**10sâ€“11s**\nThe blue player passes the ball to a teammate who is positioned near the center of the field. The white player is still marking him, trying to defend.\n\n**11sâ€“12s**\nThe new teammate in blue receives the ball and begins to dribble. The white player is still in close proximity, attempting to defend.\n\n**12sâ€“13s**\nThe blue player continues to dribble, looking for an opportunity to pass or shoot. The white player is still marking him closely, trying to prevent any progress.\n\n**13sâ€“14s**\nThe blue player passes the ball to a teammate who is positioned near the center of the field. The white player is still marking him, trying to defend.\n\n**14sâ€“15s**\nThe new teammate in blue receives the ball and begins to dribble. The white player is still in close proximity, attempting to defend.\n\n**15sâ€“16s**\nThe blue player continues to dribble, looking for an opportunity to pass or shoot. The white player is still marking him closely, trying to prevent any progress.\n\n**16sâ€“17s**\nThe blue player passes the ball to a teammate who is positioned near the center of the field. The white player is still marking him, trying to defend.\n\n**17sâ€“18s**\nThe new teammate in blue receives the ball and begins to dribble. The white player is still in close proximity, attempting to defend.\n\n**18sâ€“19s**\nThe blue player continues to dribble, looking for an opportunity to pass or shoot. The white player is still marking him closely, trying to prevent any progress.\n\n**19sâ€“20s**\nThe blue player passes the ball to a teammate who is positioned near the center of the field. The white player is still marking him, trying to defend.\n\n**20sâ€“21s**\nThe new teammate in blue receives the ball and begins to dribble. The white player is still in close proximity, attempting to defend.\n\n**21sâ€“22s**\nThe blue player continues to dribble, looking for an opportunity to pass or shoot. The white player is still marking him closely, trying to prevent any progress.\n\n**22sâ€“23s**\nThe blue player passes the ball to a teammate who is positioned near the center of the field. The white player is still marking him, trying to defend.\n\n**23sâ€“24s**\nThe new teammate in blue receives the ball and begins to dribble. The white player is still in close proximity, attempting to defend.\n\n**24sâ€“25s**\nThe blue player continues to dribble, looking for an opportunity to pass or shoot. The white player is still marking him closely, trying to prevent any progress.\n\n**25sâ€“26s**\nThe blue player passes the ball to a teammate who is positioned near the center of the field. The white player is still marking him, trying to defend.\n\n**26sâ€“27s**\nThe new teammate in blue receives the ball and begins to dribble. The white player'}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_15_Goal.mp4': {'timestamp': '1 - 07:48', 'label': 'Goal', 'description': "**Time: 0sâ€“1s**\n- The ball is in play near the center of the field, with players from both teams positioned strategically. A player in a white jersey is seen controlling the ball, preparing to make a pass or move forward.\n\n**1sâ€“2s**\n- The player in the white jersey passes the ball to a teammate who is positioned further upfield. The pass is quick and precise, indicating good teamwork and coordination.\n\n**2sâ€“3s**\n- The teammate receives the ball and begins to dribble towards the opponent's goal. The ball is moving swiftly across the field, with the player maintaining control.\n\n**3sâ€“4s**\n- As the player in the white jersey approaches the penalty area, they receive another pass from a teammate. The player continues to advance, looking for an opportunity to score.\n\n**4sâ€“5s**\n- The player in the white jersey takes a shot at the goal. The ball is powerful and well-placed, heading towards the net.\n\n**5sâ€“6s**\n- The goalkeeper in a blue jersey dives to make a save, but the ball goes past them. The ball enters the net, and the player in the white jersey celebrates by raising their arms in triumph.\n\n**6sâ€“7s**\n- The player in the white jersey continues to celebrate, running towards the corner flag. The crowd in the background is cheering, adding to the excitement of the moment.\n\n**7sâ€“8s**\n- The player in the white jersey is now near the corner flag, still celebrating. The camera focuses on their face, showing a look of joy and satisfaction.\n\n**8sâ€“9s**\n- The player in the white jersey is now running back towards the center of the field, still celebrating. The camera follows their movement, capturing the energy of the moment.\n\n**9sâ€“10s**\n- The player in the white jersey is now near the center of the field, still celebrating. The camera focuses on their face again, showing continued excitement and joy. The crowd continues to cheer in the background."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_16_Clearance.mp4': {'timestamp': '1 - 08:44', 'label': 'Clearance', 'description': "**Time: 0sâ€“1s**\n- The ball is in the air near the center of the field, with players from both teams positioned around it. A player in a blue jersey (likely the goalkeeper) is preparing to clear the ball.\n\n**1sâ€“2s**\n- The ball descends towards the ground, and a player in a white jersey (defender) jumps to head the ball away from their goal area. The ball is directed towards the right side of the field.\n\n**2sâ€“3s**\n- The ball is now in the air again, heading towards the right side of the field. A player in a blue jersey (defender) is seen jumping to intercept or clear the ball.\n\n**3sâ€“4s**\n- The ball lands on the ground near the sideline, and a player in a white jersey (defender) is seen controlling the ball with his foot. He appears to be preparing to pass the ball out of danger.\n\n**4sâ€“5s**\n- The player in the white jersey passes the ball to a teammate further up the field. The ball travels quickly across the field, moving away from the goal area.\n\n**5sâ€“6s**\n- The ball reaches a player in a white jersey who is running forward. This player seems to be advancing the ball towards midfield.\n\n**6sâ€“7s**\n- The ball is now being controlled by a player in a white jersey who is dribbling it forward. He is surrounded by players in blue jerseys (defenders) attempting to challenge him.\n\n**7sâ€“8s**\n- The player in the white jersey continues to dribble the ball, evading the defenders. He is making progress towards the opponent's half of the field.\n\n**8sâ€“9s**\n- The ball is passed to another player in a white jersey who is now in possession. This player is advancing the ball further up the field, with defenders in blue jerseys following closely behind.\n\n**9sâ€“10s**\n- The player in the white jersey continues to dribble the ball, maintaining control despite the pressure from the defenders. He is making significant progress towards the opponent's goal area."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_17_Clearance.mp4': {'timestamp': '1 - 08:46', 'label': 'Clearance', 'description': "**Time: 0sâ€“1s**\n- The ball is in the air, heading towards the goal area. A player in a white jersey (Arsenal) is seen jumping to head the ball away from the goal. The goalkeeper in a blue jersey (Chelsea) is positioned near the goalpost, ready to react.\n\n**1sâ€“2s**\n- The ball is now closer to the ground, and the player in the white jersey is still in mid-air, attempting to clear it. The goalkeeper in blue is slightly moving forward, anticipating the ball's trajectory.\n\n**2sâ€“3s**\n- The ball has landed near the goal line, and players from both teams are converging around it. The player in the white jersey is on the ground, having just cleared the ball, while the goalkeeper in blue is also on the ground, having made a save attempt.\n\n**3sâ€“4s**\n- The ball is now being contested by players from both teams near the goal line. The player in the white jersey is standing up, while the goalkeeper in blue is still on the ground, recovering from his save attempt.\n\n**4sâ€“5s**\n- The ball is being passed or intercepted by a player in a blue jersey (Chelsea) who is now controlling it near the goal line. The player in the white jersey is moving back, likely preparing to defend.\n\n**5sâ€“6s**\n- The player in the blue jersey is dribbling the ball away from the goal area, while players in white jerseys are positioning themselves to defend. The goalkeeper in blue is standing upright, observing the play.\n\n**6sâ€“7s**\n- The player in the blue jersey continues to dribble the ball, passing it to a teammate further down the field. The players in white jerseys are closing in, trying to intercept the ball.\n\n**7sâ€“8s**\n- The ball is now being passed between players in blue jerseys, advancing towards midfield. The players in white jerseys are still defending, maintaining their positions to prevent the opposing team from gaining possession.\n\n**8sâ€“9s**\n- The ball is being passed again, with players in blue advancing deeper into the field. The players in white are still defending, with one player in white moving forward to intercept the ball.\n\n**9sâ€“10s**\n- The ball is now being passed to a player in a blue jersey near the center of the field. The players in white are still defending, with one player in white moving forward to intercept the ball. The overall scene shows the ball being passed and defended as the game progresses."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_18_Kick-off.mp4': {'timestamp': '1 - 09:17', 'label': 'Kick-off', 'description': "### Detailed Analysis of the Video Clip\n\n#### Time: 0sâ€“1s\n- **Description**: A player in a blue jersey with long hair is seen walking towards the center circle of the field. The crowd in the background is visible, indicating a live match setting.\n- **Player Action**: The player appears to be preparing for the kick-off, moving deliberately towards the center of the field.\n\n#### Time: 1sâ€“2s\n- **Description**: The player in the blue jersey continues to walk, now closer to the center circle. Another player in a dark-colored outfit is seen nearby, likely a referee or another team member.\n- **Player Action**: The player in blue seems to be communicating or adjusting his position, possibly in preparation for the kick-off.\n\n#### Time: 2sâ€“3s\n- **Description**: The camera shifts focus to the ground, showing the player's feet as he steps forward. The ball is not yet visible, suggesting the kick-off has not yet occurred.\n- **Player Action**: The player in blue takes a few steps, likely to position himself correctly for the kick-off.\n\n#### Time: 3sâ€“4s\n- **Description**: The player in blue is now standing still, facing the center circle. His body posture suggests readiness for the kick-off.\n- **Player Action**: The player appears focused, possibly waiting for the referee's signal to begin the kick-off.\n\n#### Time: 4sâ€“5s\n- **Description**: The camera angle changes slightly, showing the player's legs and the grassy field. The player's socks and shoes are clearly visible.\n- **Player Action**: The player remains stationary, maintaining his position near the center circle.\n\n#### Time: 5sâ€“6s\n- **Description**: The player in blue is still positioned near the center circle, with no significant movement observed.\n- **Player Action**: The player appears to be waiting for the referee's signal to start the kick-off.\n\n#### Time: 6sâ€“7s\n- **Description**: The camera focuses on the player's lower body, showing him standing still with his legs apart. The grass and the edge of the field are visible.\n- **Player Action**: The player maintains his position, indicating readiness for the kick-off.\n\n#### Time: 7sâ€“8s\n- **Description**: The player in blue is still near the center circle, with no noticeable movement. The camera angle shows more of the field and the surrounding area.\n- **Player Action**: The player remains stationary, waiting for the kick-off to commence.\n\n#### Time: 8sâ€“9s\n- **Description**: The player in blue is now seen from a different angle, closer to the center circle. He appears to be looking around, possibly checking his surroundings.\n- **Player Action**: The player seems to be mentally preparing for the kick-off, ensuring he is in the correct position.\n\n#### Time: 9sâ€“10s\n- **Description**: The player in blue is now positioned very close to the center circle, with his body angled slightly forward. The camera captures a wider view of the field and the surrounding area.\n- **Player Action**: The player appears ready to receive the ball, with his body posture indicating anticipation for the kick-off.\n\n### Summary\nThe video clip captures the moments leading up to a kick-off in a soccer match. The player in the blue jersey is seen preparing for the kick-off, moving towards the center circle and positioning himself correctly. The sequence shows the player's deliberate movements and readiness, culminating in a moment where he is poised to receive the ball when the kick-off occurs."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_20_Clearance.mp4': {'timestamp': '1 - 10:05', 'label': 'Clearance', 'description': "**Time: 0sâ€“1s**\n- The scene opens with a close-up of a coach on the sidelines, appearing frustrated or disappointed, with his hands on his head. The camera then cuts to a player in a white and blue jersey, likely a Chelsea player given the context, looking off to the side.\n\n**Time: 1sâ€“2s**\n- The camera remains focused on the Chelsea player, who seems to be observing the field or reacting to something happening on the pitch.\n\n**Time: 2sâ€“3s**\n- The scene transitions to a wide shot of the football field, showing players from both teams positioned across the pitch. The ball is near the center, and players are moving strategically.\n\n**Time: 3sâ€“4s**\n- The ball is passed forward by a player in a dark-colored jersey, possibly Tottenham Hotspur, towards the midfield area. The camera follows the ball's movement.\n\n**Time: 4sâ€“5s**\n- The ball reaches a player in a white and blue jersey, who appears to be advancing with the ball. The camera tracks the ball as it moves towards the opponent's half.\n\n**Time: 5sâ€“6s**\n- The player in the white and blue jersey continues to dribble the ball, evading defenders in dark jerseys. The camera maintains focus on the ball and the player's movements.\n\n**Time: 6sâ€“7s**\n- The ball is passed to another teammate in a white and blue jersey, who is now in possession. The camera follows the ball as it is passed again.\n\n**Time: 7sâ€“8s**\n- The ball is received by a player in a white and blue jersey, who is now in a more advanced position closer to the opponent's goal. The camera continues to track the ball's movement.\n\n**Time: 8sâ€“9s**\n- The player in the white and blue jersey makes a quick pass to a teammate, who is positioned near the edge of the penalty box. The camera follows the ball as it is passed.\n\n**Time: 9sâ€“10s**\n- The ball is received by a player in a white and blue jersey, who is now in a good position to attempt a shot on goal. The camera focuses on the player preparing to take the shot.\n\n**Time: 10sâ€“11s**\n- The player in the white and blue jersey takes a shot on goal. The ball is seen heading towards the goal, and the goalkeeper in a blue jersey dives to make a save.\n\n**Time: 11sâ€“12s**\n- The ball is deflected by the goalkeeper, and the camera follows its trajectory as it bounces away from the goal area.\n\n**Time: 12sâ€“13s**\n- The ball is cleared by a defender in a dark jersey, who kicks it out of the danger zone. The camera follows the ball as it is kicked away from the goal area.\n\n**Time: 13sâ€“14s**\n- The ball is now in play again, and the camera shows players from both teams repositioning themselves on the field. The ball is seen moving back towards the midfield area.\n\n**Time: 14sâ€“15s**\n- The ball is passed back to a player in a dark jersey, who is now in possession. The camera follows the ball as it is passed to a teammate.\n\n**Time: 15sâ€“16s**\n- The ball is received by a player in a dark jersey, who is now in a good position to advance with the ball. The camera tracks the ball as it is passed.\n\n**Time: 16sâ€“17s**\n- The ball is passed to another player in a dark jersey, who is now in a more advanced position. The camera follows the ball as it is moved further up the field.\n\n**Time: 17sâ€“18s**\n- The ball is received by a player in a dark jersey, who is now in a good position to attempt a shot on goal. The camera focuses on the player preparing to take the shot.\n\n**Time: 18sâ€“19s**\n- The player in the dark jersey takes a shot on goal. The ball is seen heading towards the goal, and the goalkeeper in a blue jersey dives to make a save.\n\n**Time: 19sâ€“20s**\n- The ball is deflected by the goalkeeper, and the camera follows its trajectory as it bounces away from the goal area.\n\n**Time: 20sâ€“21s**\n- The ball is cleared by a defender in a dark jersey, who kicks it out of the danger zone. The camera follows the ball as it is kicked away from the goal area.\n\n**Time: 21sâ€“22s**\n- The ball is now in play again, and the camera shows players from both teams repositioning themselves on the field. The ball is seen moving back"}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_21_Foul.mp4': {'timestamp': '1 - 11:00', 'label': 'Foul', 'description': "### Detailed Analysis of the Video Clip\n\n#### Time: 0sâ€“1s\n- **Description**: The scene opens with a wide view of the field showing players from both teams positioned strategically. The ball is near the center of the pitch, and players are moving around, preparing for the next play. The player in the white and blue striped jersey appears to be advancing with the ball while being closely marked by players in blue jerseys.\n\n#### Time: 1sâ€“2s\n- **Description**: The player in the white and blue striped jersey continues to dribble forward, maintaining possession of the ball. The blue team's defense is actively trying to intercept or challenge him.\n\n#### Time: 2sâ€“3s\n- **Description**: As the player in the white and blue striped jersey advances, he is met by a challenge from a blue-uniformed player. The two players collide, causing the player in the white and blue striped jersey to lose control of the ball momentarily.\n\n#### Time: 3sâ€“4s\n- **Description**: The player in the white and blue striped jersey stumbles and falls to the ground, losing possession of the ball. The blue-uniformed player who challenged him is now standing over him, appearing to be in a defensive stance.\n\n#### Time: 4sâ€“5s\n- **Description**: The player in the white and blue striped jersey is lying on the ground, holding his leg, indicating he may have been fouled. The blue-uniformed player who challenged him is still standing nearby, looking towards the referee.\n\n#### Time: 5sâ€“6s\n- **Description**: The referee, dressed in yellow, approaches the scene to assess the situation. Other players from both teams are watching the interaction closely, with some players in blue uniforms appearing concerned about their teammate's well-being.\n\n#### Time: 6sâ€“7s\n- **Description**: The referee is now closer to the fallen player, observing the situation carefully. The player in the white and blue striped jersey remains on the ground, clutching his leg, while the blue-uniformed player who challenged him stands nearby, waiting for the referee's decision.\n\n#### Time: 7sâ€“8s\n- **Description**: The referee makes a gesture, likely indicating a foul has occurred. The blue-uniformed player who challenged the player in the white and blue striped jersey steps back slightly, acknowledging the referee's decision.\n\n#### Time: 8sâ€“9s\n- **Description**: The referee raises his hand, signaling a foul. The player in the white and blue striped jersey begins to get up from the ground, while the blue-uniformed player who challenged him also starts to move away from the scene.\n\n#### Time: 9sâ€“10s\n- **Description**: The referee continues to gesture, confirming the foul. The player in the white and blue striped jersey is now standing, and the blue-uniformed player who challenged him is walking away, possibly to check on his own position on the field.\n\n### Summary\nThe sequence shows a clear foul occurring when a player in a white and blue striped jersey is challenged by a blue-uniformed player. The referee intervenes, confirms the foul, and the players react accordingly. The foul results in the player in the white and blue striped jersey falling to the ground, while the blue-uniformed player who challenged him steps back and acknowledges the referee's decision."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_22_Substitution.mp4': {'timestamp': '1 - 11:06', 'label': 'Substitution', 'description': "**Time: 0sâ€“1s**\nA Tottenham player in a white jersey is lying on the ground after a tackle by a Chelsea player in a blue jersey. The Tottenham player appears to be injured, clutching his leg. Other players from both teams are nearby, observing the situation.\n\n**1sâ€“2s**\nThe Tottenham player remains on the ground, still holding his leg. A Chelsea player in a blue jersey walks past him, seemingly unbothered. Another Chelsea player in a blue jersey with the number 8 on his back approaches the injured Tottenham player.\n\n**2sâ€“3s**\nThe Chelsea player with the number 8 on his back bends down towards the Tottenham player, possibly checking on his condition or preparing to help him up. The Tottenham player continues to hold his leg.\n\n**3sâ€“4s**\nThe Tottenham player is now being assisted by a Chelsea player in a blue jersey. The player in the blue jersey helps the Tottenham player to sit up slightly while other players from both teams continue to observe the scene.\n\n**4sâ€“5s**\nThe Tottenham player is now sitting on the ground, supported by the Chelsea player in the blue jersey. The Tottenham player appears to be in pain, holding his leg tightly.\n\n**5sâ€“6s**\nThe Tottenham player is now being helped off the field by a Tottenham coach or medical staff member. The player is still holding his leg, indicating ongoing discomfort.\n\n**6sâ€“7s**\nThe Tottenham player is being carried off the field by the medical staff member. The player's teammates and opponents are watching the scene unfold.\n\n**7sâ€“8s**\nThe Tottenham player is now being walked away from the field by the medical staff member. The player's teammates and opponents are still present, some looking concerned.\n\n**8sâ€“9s**\nThe Tottenham player is now being guided off the field by the medical staff member. The player's teammates and opponents are still present, some looking concerned.\n\n**9sâ€“10s**\nThe Tottenham player is now being walked off the field by the medical staff member. The player's teammates and opponents are still present, some looking concerned. The scene suggests a substitution is imminent as the player is being removed from the field due to injury."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_23_Substitution.mp4': {'timestamp': '1 - 11:08', 'label': 'Substitution', 'description': "**Time: 0sâ€“1s**\nA player in a white Tottenham Hotspur jersey lies on the ground, seemingly injured. Another player in a blue Chelsea jersey walks past him, appearing concerned. A third player in a white jersey stands nearby, observing the situation.\n\n**1sâ€“2s**\nThe player in the white Tottenham Hotspur jersey remains on the ground, while the player in the blue Chelsea jersey continues to walk away. The player in the white jersey bends down, possibly checking on his teammate or preparing to leave the field.\n\n**2sâ€“3s**\nThe player in the white Tottenham Hotspur jersey is now being attended to by medical staff. He is lying on the ground with his head down, and a medical professional is bending over him, possibly assessing his condition.\n\n**3sâ€“4s**\nThe player in the white Tottenham Hotspur jersey is still on the ground, and the medical professional continues to attend to him. Another individual, likely a coach or team staff member, approaches the scene.\n\n**4sâ€“5s**\nThe player in the white Tottenham Hotspur jersey is now being helped off the field by two individuals, one of whom appears to be a coach or team staff member. The player is being supported as he walks away from the field.\n\n**5sâ€“6s**\nThe player in the white Tottenham Hotspur jersey is being assisted by a coach or team staff member as he walks towards the sideline. The player's teammates and opponents are watching the situation unfold.\n\n**6sâ€“7s**\nThe player in the white Tottenham Hotspur jersey is now being helped off the field by a coach or team staff member. The player is walking slowly, supported by the individual assisting him.\n\n**7sâ€“8s**\nThe player in the white Tottenham Hotspur jersey is being helped off the field by a coach or team staff member. The player is walking slowly, supported by the individual assisting him. The player's teammates and opponents are watching the situation unfold.\n\n**8sâ€“9s**\nThe player in the white Tottenham Hotspur jersey is now being helped off the field by a coach or team staff member. The player is walking slowly, supported by the individual assisting him. The player's teammates and opponents are watching the situation unfold.\n\n**9sâ€“10s**\nThe player in the white Tottenham Hotspur jersey is being helped off the field by a coach or team staff member. The player is walking slowly, supported by the individual assisting him. The player's teammates and opponents are watching the situation unfold. The player in the white Tottenham Hotspur jersey is now being carried off the field by the medical staff."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_24_Substitution.mp4': {'timestamp': '1 - 11:39', 'label': 'Substitution', 'description': '**Time: 0sâ€“1s**\n- A player in a teal goalkeeper uniform interacts with another individual near the sideline. The goalkeeper appears to be receiving instructions or a piece of equipment.\n- The individual assisting the goalkeeper is dressed in a dark blue puffer jacket.\n\n**Time: 1sâ€“2s**\n- The goalkeeper bends slightly, possibly adjusting his gloves or preparing to receive further instructions.\n- The individual continues to gesture, likely giving directions or encouragement.\n\n**Time: 2sâ€“3s**\n- The goalkeeper stands upright again, facing away from the camera, while the individual in the puffer jacket continues to gesture.\n\n**Time: 3sâ€“4s**\n- The goalkeeper turns slightly towards the field, indicating readiness to return to the game.\n\n**Time: 4sâ€“5s**\n- The goalkeeper walks away from the sideline, heading back onto the pitch.\n\n**Time: 5sâ€“6s**\n- The scene shifts to show a player in a blue uniform standing on the field, preparing to take a free kick. The ball is positioned in front of him, and he appears focused.\n\n**Time: 6sâ€“7s**\n- The player in blue takes a few steps back, positioning himself for the free kick. His body language suggests concentration and readiness.\n\n**Time: 7sâ€“8s**\n- The player in blue stands still, maintaining his position, with the ball at his feet, ready to execute the free kick.\n\n**Time: 8sâ€“9s**\n- The player in blue begins to take a few steps forward, preparing to strike the ball.\n\n**Time: 9sâ€“10s**\n- The player in blue executes the free kick, sending the ball flying across the field.'}}

# Example Usage:
if __name__ == "__main__":
    # Example match context
    match_context = "It's a Premier League match between Tottenham and Chelsea. Tottenham plays with white jerseys, and Chelsea plays with dark blue jerseys."

    # Example descriptions dictionary from the VLM output
    #descriptions = {
    #    '1 - 01:34': {'label': 'Throw-in', 'description': '**0-2 seconds:** The throw-in begins with the player in the defending team (wearing white jerseys) preparing to throw the ball back into play. The player is positioned near the corner flag, holding the ball securely with both hands. The ball is thrown into the field of play, and the camera follows its trajectory.\n\n**2-4 seconds:** The ball lands near the center of the field, and the attacking team (wearing blue jerseys) quickly gathers around it. The player in possession of the ball (blue jersey) starts to control it, using their feet to direct the ball away from the defending team. The defending team players are moving towards the ball, attempting to intercept it.\n\n**4-6 seconds:** The player in the blue jersey passes the ball to a teammate who is positioned further up the field. The pass is made with a short, controlled kick, and the ball travels across the field. The defending team players continue to move forward, trying to press and regain possession.\n\n**6-8 seconds:** The ball reaches the receiving player in the blue jersey, who is now in a more advanced position. This player takes a few steps forward and then kicks the ball back towards the center of the field. The defending team players are still moving towards the ball, but they are slightly behind the attacking team.\n\n**8-10 seconds:** The ball is kicked by the blue-jerseyed player and travels across the field again. It lands near the center of the field, and the defending team players are now positioned closer to it. The ball is then intercepted by one of the defending players, who gains possession and starts to move the ball back towards their own goal.'},
    #    '1 - 02:07': {'label': 'Goal', 'description': '**0-2 seconds:** The ball is in play near the center of the field. A player in a red jersey (Team A) receives the ball and begins to dribble forward. Another player in a blue jersey (Team B) is positioned nearby, observing the movement.\n\n**2-4 seconds:** As Team A advances the ball, a defender in a blue jersey (Team B) starts to close in, attempting to press the attacker. The ball is passed quickly between two players in red jerseys, maintaining possession and advancing the attack.\n\n**4-6 seconds:** The ball reaches a forward in a red jersey who is positioned near the edge of the penalty area. This player takes a few steps back and then accelerates towards the goal, preparing to take a shot.\n\n**6-8 seconds:** The forward in red approaches the penalty spot and takes a powerful shot at the goal. The goalkeeper in a green jersey (Team B) dives to make a save but fails to stop the ball.\n\n**8-10 seconds:** The ball enters the net, and the referee raises his arm to signal a goal. Players from both teams react; Team A celebrates the goal with excitement, while Team B shows disappointment. The ball remains in the net, and the match continues with the next phase of play.'}
    #}
    # descriptions = {'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_0_Corner.mp4': {'timestamp': '1 - 00:37', 'label': 'Corner', 'description': '**Time: 0sâ€“1s**\n- The ball is in play near the corner flag. A player in a white jersey is controlling the ball, preparing to take a corner kick. Other players are positioned around the penalty area, ready to react.\n\n**1sâ€“2s**\n- The player in the white jersey takes the corner kick, sending the ball into the penalty area. Opposing players in blue jerseys are positioned to defend against the cross.\n\n**2sâ€“3s**\n- The ball is in mid-air, heading towards the goal. Players in blue jerseys are jumping and attempting to head the ball away from their goal.\n\n**3sâ€“4s**\n- The ball is close to the goal line, with players in blue jerseys trying to clear it. The goalkeeper in a blue jersey is positioned near the goalpost, ready to make a save if necessary.\n\n**4sâ€“5s**\n- The ball is cleared by a player in a blue jersey, who kicks it back into play. The ball is now in the midfield area, with players from both teams moving to regain control.\n\n**5sâ€“6s**\n- The ball is passed by a player in a white jersey to a teammate near the center circle. The player in white is looking for an opportunity to advance the ball further.\n\n**6sâ€“7s**\n- The player in white passes the ball to another teammate, who is positioned closer to the goal. The player in white is still in the process of moving forward.\n\n**7sâ€“8s**\n- The player in white receives the pass and prepares to take a shot on goal. The goalkeeper in blue is positioned near the goalpost, ready to defend.\n\n**8sâ€“9s**\n- The player in white takes a shot on goal. The ball is heading towards the goal, with the goalkeeper in blue attempting to make a save.\n\n**9sâ€“10s**\n- The ball hits the crossbar and bounces back out of play. The goalkeeper in blue catches the ball, preventing it from entering the net. The players in white are disappointed, while the players in blue celebrate the successful clearance.'}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_4_Throw-in.mp4': {'timestamp': '1 - 01:34', 'label': 'Throw-in', 'description': "**Time: 0sâ€“1s**\n- A player wearing a blue jersey with the number 25 on the back is holding a soccer ball above his head. He appears to be preparing to throw the ball in.\n\n**1sâ€“2s**\n- The player lowers the ball slightly and begins to move forward, indicating he is about to execute the throw-in.\n\n**2sâ€“3s**\n- The player continues to walk while holding the ball, maintaining a steady pace towards the sideline where the throw-in will take place.\n\n**3sâ€“4s**\n- The player reaches the sideline and throws the ball into the air, initiating the throw-in.\n\n**4sâ€“5s**\n- The ball is thrown into the air, and players from both teams are positioned around the throw-in area, ready to react to the ball's trajectory.\n\n**5sâ€“6s**\n- The ball descends towards the field, and players from the team in white jerseys begin to move towards the ball, anticipating a potential clearance or interception.\n\n**6sâ€“7s**\n- The ball lands near the feet of a player in a white jersey, who appears to be preparing to control or pass the ball.\n\n**7sâ€“8s**\n- The player in white gains possession of the ball and starts to dribble it away from the throw-in spot, moving towards the midfield.\n\n**8sâ€“9s**\n- The player in white continues to dribble the ball, passing it to a teammate further up the field.\n\n**9sâ€“10s**\n- The player in white passes the ball to another teammate, who is now in a better position to advance the play. The ball is passed quickly, and the opposing team in blue jerseys begins to defend against the advancing play."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_6_Throw-in.mp4': {'timestamp': '1 - 01:52', 'label': 'Throw-in', 'description': "### Detailed Analysis of the Video Clip\n\n#### Time: 0sâ€“1s\n- **Player Action**: A player in a blue jersey (number 29) is preparing to take a throw-in. He is holding the ball with both hands above his head.\n- **Ball Movement**: The ball is stationary, held by the player.\n- **Team Roles**: The player is a defender, and he is preparing to throw the ball back into play.\n\n#### Time: 1sâ€“2s\n- **Player Action**: The player in the blue jersey (number 29) begins to throw the ball. His arm is extended, and the ball is in motion.\n- **Ball Movement**: The ball is thrown forward, starting its trajectory towards the field.\n- **Team Roles**: The player's teammates in blue jerseys are positioned near the sideline, ready to receive the throw-in.\n\n#### Time: 2sâ€“3s\n- **Player Action**: The player in the blue jersey (number 29) completes the throw-in. His arm is fully extended, and the ball is now traveling through the air.\n- **Ball Movement**: The ball is in mid-air, heading towards the field.\n- **Team Roles**: The player's teammates in blue jerseys remain in position, anticipating the throw-in.\n\n#### Time: 3sâ€“4s\n- **Player Action**: The ball continues its flight after being thrown by the player in the blue jersey (number 29).\n- **Ball Movement**: The ball is still in the air, moving towards the field.\n- **Team Roles**: The player's teammates in blue jerseys are still positioned near the sideline, ready to receive the throw-in.\n\n#### Time: 4sâ€“5s\n- **Player Action**: The ball reaches the field and lands near the center circle.\n- **Ball Movement**: The ball is now on the ground, and players from both teams are positioning themselves to gain possession.\n- **Team Roles**: The player in the blue jersey (number 29) has completed the throw-in, and the ball is now in play.\n\n#### Time: 5sâ€“6s\n- **Player Action**: The ball is in play, and players from both teams are competing for possession.\n- **Ball Movement**: The ball is rolling across the field.\n- **Team Roles**: Players in white jerseys (opposing team) are defending, while players in blue jerseys (home team) are advancing.\n\n#### Time: 6sâ€“7s\n- **Player Action**: A player in a white jersey (opposing team) gains control of the ball.\n- **Ball Movement**: The player in the white jersey dribbles the ball forward.\n- **Team Roles**: The player in the white jersey is advancing with the ball, while players in blue jerseys are tracking him.\n\n#### Time: 7sâ€“8s\n- **Player Action**: The player in the white jersey continues to dribble the ball forward.\n- **Ball Movement**: The ball is being controlled by the player in the white jersey.\n- **Team Roles**: The player in the white jersey is advancing with the ball, while players in blue jerseys are tracking him.\n\n#### Time: 8sâ€“9s\n- **Player Action**: The player in the white jersey passes the ball to a teammate.\n- **Ball Movement**: The ball is passed forward.\n- **Team Roles**: The player in the white jersey makes a pass, and the ball is now in the possession of another player in a white jersey.\n\n#### Time: 9sâ€“10s\n- **Player Action**: The player in the white jersey receives the ball and continues to advance.\n- **Ball Movement**: The ball is being controlled by the player in the white jersey.\n- **Team Roles**: The player in the white jersey is advancing with the ball, while players in blue jerseys are tracking him.\n\n### Summary\nThe sequence shows a player in a blue jersey taking a throw-in and throwing the ball back into play. The ball travels through the air and lands near the center circle, where players from both teams compete for possession. The player in the white jersey gains control of the ball and starts advancing with it, passing it to a teammate who continues to move forward."}, 'data/app_test/action/custom/1_720p.mkv/clips_tracked/clip_7_Goal.mp4': {'timestamp': '1 - 02:07', 'label': 'Goal', 'description': '**Time: 0sâ€“1s**\n- The ball is in play near the Tottenham Hotspur (TOTT) midfield area. A player in a white jersey (TOTT) is controlling the ball while being marked by a player in a blue jersey (CHE).\n\n**Time: 1sâ€“2s**\n- The player in the white jersey passes the ball to a teammate positioned further upfield. The player in the blue jersey continues to track the movement of the ball.\n\n**Time: 2sâ€“3s**\n- The white-jerseyed player receives the pass and dribbles forward, advancing towards the Chelsea (CHE) defense.\n\n**Time: 3sâ€“4s**\n- The player in the white jersey continues to advance with the ball, evading the pressure from the blue-jerseyed defender.\n\n**Time: 4sâ€“5s**\n- The white-jerseyed player makes a quick pass to another teammate who is positioned closer to the CHE goal.\n\n**Time: 5sâ€“6s**\n- The teammate in the white jersey receives the pass and takes a shot at the CHE goal. The ball is directed towards the CHE goalkeeper.\n\n**Time: 6sâ€“7s**\n- The CHE goalkeeper dives to make a save, but the ball goes past him into the net.\n\n**Time: 7sâ€“8s**\n- The ball is now inside the CHE goal, and the TOTT players celebrate the goal. They run towards each other, hugging and cheering.\n\n**Time: 8sâ€“9s**\n- The TOTT players continue to celebrate, with one player raising his arms in triumph.\n\n**Time: 9sâ€“10s**\n- The TOTT players gather around, embracing each other in joy. The crowd in the background is also seen cheering enthusiastically.'}}

    # Generate commentary and save to CSV
    results = generate_commentary(DESCRIPTIONS_OUTPUT, match_context)

    # Print the generated commentaries
    print("\nðŸ“‹ Generated Commentaries:")
    print(results)


